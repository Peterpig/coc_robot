"""
天鹰火炮成就刷取任务模块

该模块提供自动搜索敌人天鹰火炮并使用雷电法术攻击的功能。
适用于刷取"天鹰艺术家"等相关成就。
"""

from 任务流程.基础任务框架 import 基础任务
from 任务流程.主世界打鱼.打开进攻页面 import 打开进攻页面任务  # 复用现有任务
from .天鹰火炮进攻任务 import 天鹰火炮进攻任务
from .等待战斗结束并回营 import 等待战斗结束并回营任务


class 刷天鹰火炮任务(基础任务):
    """天鹰火炮成就刷取任务链

    任务流程：
    1. 打开进攻页面
    2. 搜索敌人并检测天鹰火炮，使用雷电法术攻击
    3. 放弃战斗并返回营地
    """

    def 执行(self) -> bool:
        """执行刷天鹰火炮的主逻辑"""
        上下文 = self.上下文
        上下文.置脚本状态("开始刷天鹰火炮任务")

        try:
            # 任务链：打开进攻页面 -> 搜索并攻击天鹰火炮 -> 等待战斗结束回营
            任务列表 = [
                打开进攻页面任务(上下文),
                天鹰火炮进攻任务(上下文),
                等待战斗结束并回营任务(上下文),
            ]

            for 索引, 子任务 in enumerate(任务列表, start=1):
                任务名 = type(子任务).__name__
                上下文.置脚本状态(f"执行第{索引}步: {任务名}", 60*3)

                if not 子任务.执行():  # 注意：不再传递上下文参数
                    上下文.置脚本状态(f"子任务 [{任务名}] 执行失败，终止刷天鹰火炮任务链")
                    return False

            上下文.置脚本状态("天鹰火炮任务完成")
            return True

        except Exception as e:
            self.异常处理(e)
            return False


__all__ = ['刷天鹰火炮任务']
