"""
任务元数据集中注册

此模块集中定义所有任务的元数据，用于：
1. 配置管理面板自动生成UI
2. 任务参数的类型定义和默认值
3. 任务间依赖关系声明
"""
from 任务流程.任务元数据 import 任务元数据, 任务参数定义, UI控件类型


# === 运行模式（控制整体流程）===
运行模式元数据 = 任务元数据(
    任务名称="运行模式",
    显示名称="运行模式设置",
    描述="控制机器人运行哪些任务",
    参数列表=[
        任务参数定义(
            参数名="是否刷主世界",
            参数类型=bool,
            默认值=True,
            描述="启用主世界打鱼",
            UI控件=UI控件类型.复选框
        ),
        任务参数定义(
            参数名="是否刷夜世界",
            参数类型=bool,
            默认值=False,
            描述="启用夜世界打鱼",
            UI控件=UI控件类型.复选框
        ),
        任务参数定义(
            参数名="是否刷天鹰火炮",
            参数类型=bool,
            默认值=False,
            描述="启用天鹰火炮成就刷取",
            UI控件=UI控件类型.复选框
        ),
    ]
)


# === 主世界打鱼任务 ===
主世界打鱼元数据 = 任务元数据(
    任务名称="主世界打鱼",
    显示名称="主世界打鱼",
    描述="搜索并攻击资源丰富的村庄",
    参数列表=[
        任务参数定义(
            参数名="欲进攻的最小资源",
            参数类型=int,
            默认值=200000,
            描述="搜索村庄对方必须高过的资源总量，超过该值才会触发进攻",
            UI控件=UI控件类型.输入框,
            最小值=0,
            最大值=10000000
        ),
        任务参数定义(
            参数名="欲进攻资源建筑靠近地图边缘最小比例",
            参数类型=float,
            默认值=0.6,
            描述="资源建筑靠近边缘的比例阈值(0-1)，高本建议0.6，低本可设0.0",
            UI控件=UI控件类型.输入框,
            最小值=0.0,
            最大值=1.0
        ),
    ]
)


# === 升级城墙任务 ===
升级城墙元数据 = 任务元数据(
    任务名称="升级城墙",
    显示名称="升级城墙",
    描述="使用金币或圣水自动升级城墙",
    参数列表=[
        任务参数定义(
            参数名="开启刷墙",
            参数类型=bool,
            默认值=False,
            描述="是否启用刷墙功能",
            UI控件=UI控件类型.复选框
        ),
        任务参数定义(
            参数名="刷墙起始金币",
            参数类型=int,
            默认值=200000,
            描述="金币高于此值触发刷墙",
            UI控件=UI控件类型.输入框,
            最小值=0,
            最大值=10000000
        ),
        任务参数定义(
            参数名="刷墙起始圣水",
            参数类型=int,
            默认值=200000,
            描述="圣水高于此值触发刷墙（低本建议设大值避免触发）",
            UI控件=UI控件类型.输入框,
            最小值=0,
            最大值=10000000
        ),
    ]
)


# === 英雄升级任务 ===
英雄升级元数据 = 任务元数据(
    任务名称="英雄升级",
    显示名称="英雄升级",
    描述="自动升级选定的英雄",
    参数列表=[
        任务参数定义(
            参数名="欲升级的英雄",
            参数类型=list,
            默认值=["弓箭女皇", "亡灵王子", "飞盾战神"],
            描述="选择要升级的英雄，可多选",
            UI控件=UI控件类型.多选框,
            候选项=["野蛮人之王", "弓箭女皇", "亡灵王子", "飞盾战神", "大守护者"]
        ),
    ]
)


# === 全局注册表 ===
# 按显示顺序排列
已注册任务元数据 = [
    运行模式元数据,
    主世界打鱼元数据,
    升级城墙元数据,
    英雄升级元数据,
]


def 获取任务元数据(任务名称: str) -> 任务元数据 | None:
    """根据任务名称获取元数据"""
    for 元数据 in 已注册任务元数据:
        if 元数据.任务名称 == 任务名称:
            return 元数据
    return None


def 获取所有参数默认值(任务名称: str) -> dict:
    """获取指定任务的所有参数默认值"""
    元数据 = 获取任务元数据(任务名称)
    if not 元数据:
        return {}
    return {参数.参数名: 参数.默认值 for 参数 in 元数据.参数列表}
