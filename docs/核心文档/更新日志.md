# 07 - 更新日志

## 2026-02 - UI配置系统重构

### UI自动生成功能

**改动文件**：
- `数据库/任务数据库.py`
- `界面/配置管理面板.py`

**新增功能**：
- ✅ 通过 dataclass metadata 自动生成配置UI
- ✅ 支持6种控件类型：entry, spinbox, combo, bool, editable_list, hidden
- ✅ 可编辑列表控件（支持自定义添加项目）
- ✅ 鼠标滚轮全区域支持

**字段更名**：
- `欲升级的英雄` → `欲升级的英雄或建筑`
- 数据库自动迁移旧字段

**影响**：
- 添加新配置字段无需修改UI代码
- 配置面板自动适配新字段
- 用户可自定义建筑/英雄名称

**文档**：
- 新增 `.claude/03-UI配置系统.md`

---

## 2026-02 - 天鹰火炮成就刷取功能

**改动文件**：
- 新增 `任务流程/天鹰火炮成就/` 模块
- `数据库/任务数据库.py` - 新增字段 `是否刷天鹰火炮`

**功能说明**：
- 使用YOLO v8 + ONNX Runtime检测天鹰火炮
- 雷电法术攻击11次，±5像素抖动
- 支持GPU/CPU自动切换
- 小目标过滤（宽≥20, 高≥20, 面积≥400）

**技术特点**：
- 独立YOLO v8检测器（与主项目YOLO v5隔离）
- 自动模型转换（PT→ONNX）
- 置信度阈值：0.20

**使用方法**：
- GUI：配置管理中开启"是否刷天鹰火炮"
- 命令行：`python 主入口.py 是否刷天鹰火炮`

---

## 2026-02 - 用户协议功能

**改动文件**：
- `UI入口.py`
- `数据库/任务数据库.py` - 新增 `系统配置` 表

**功能说明**：
- 首次启动显示用户协议弹窗
- 用户必须同意后才能使用
- 可随时查看/撤销协议

**协议内容**：
- 采用正式法律文书格式
- 包含九条条款
- 明确风险和责任

**菜单入口**：
- 设置 → 撤销协议同意
- 设置 → 查看用户协议

---

## 2026-02 - 基类统一重构

**改动文件**：
- `任务流程/基础任务框架.py`
- 所有任务类

**主要改动**：
1. 合并 `基础任务` 和 `夜世界基础任务`
2. 统一方法签名：`执行(self)` 替代 `执行(self, 上下文)`
3. 统一异常处理：委托给 `上下文.处理异常()`
4. 自动初始化检测引擎（模板、OCR、YOLO）

**向后兼容**：
- `夜世界基础任务` 作为 `基础任务` 的别名保留

**影响**：
- 任务类更简洁
- 代码重复度降低
- 维护更容易

---

## 2026-02 - 死循环检测

**改动文件**：
- `任务流程/主世界打鱼/进攻.py`
- 其他循环任务

**改动内容**：
- 添加循环计数器
- 超过阈值（默认50次）抛出 RuntimeError
- 触发自动重启机制

**目的**：
- 防止死循环导致卡死
- 提高稳定性

---

## 2026-01 - 项目初始化

**主要功能**：
- 任务框架设计
- 主世界打鱼
- 夜世界打鱼
- 建筑升级
- 英雄升级
- 城墙升级
- GUI界面

**技术选型**：
- Python 3.10.9
- YOLO v5图像识别
- PaddleOCR文字识别
- OpenCV模板匹配
- SQLite数据库
- Tkinter GUI

---

## 未来计划

### 计划中的功能

- [ ] 自动捐兵
- [ ] 部落战自动进攻
- [ ] 联赛自动打
- [ ] 多账号切换
- [ ] 数据统计面板
- [ ] 远程控制

### 优化计划

- [ ] 提高识别准确率
- [ ] 优化性能
- [ ] 减少内存占用
- [ ] 改进错误处理
- [ ] 完善文档

### 已知问题

- [ ] 低本圣水刷墙识别不准
- [ ] 天鹰火炮小目标检测偶尔失败
- [ ] 网络波动导致识别延迟

---

## 版本命名规则

本项目不使用语义化版本号（SemVer），而是使用**日期标识**：

格式：`YYYY-MM-功能描述`

例如：
- `2026-02-UI自动生成` - 2026年2月添加UI自动生成功能
- `2026-02-天鹰火炮` - 2026年2月添加天鹰火炮功能

---

## 贡献记录

### 主要贡献者

- **项目作者**：qilishidai
- **AI助手**：Claude Sonnet 4.5 (Anthropic)

### 贡献统计

- 总提交数：待统计
- 代码行数：待统计
- 文档数量：20+

---

## 文档更新记录

| 日期 | 文档 | 改动 |
|------|------|------|
| 2026-02-07 | 全部 | 拆分CLAUDE.md为7个独立文档 |
| 2026-02-07 | 03-UI配置系统.md | 新增UI自动生成文档 |
| 2026-02 | CLAUDE.md | 添加天鹰火炮功能说明 |
| 2026-02 | CLAUDE.md | 添加用户协议功能说明 |

---

## 参考资料

### 相关项目

- [YOLO v5](https://github.com/ultralytics/yolov5)
- [YOLO v8](https://github.com/ultralytics/ultralytics)
- [PaddleOCR](https://github.com/PaddlePaddle/PaddleOCR)
- [雷电模拟器](https://www.ldplayer.net/)

### 技术文档

- [Claude Code文档](https://docs.anthropic.com/claude-code)
- [Python dataclasses](https://docs.python.org/3/library/dataclasses.html)
- [Tkinter教程](https://docs.python.org/3/library/tkinter.html)
- [OpenCV教程](https://docs.opencv.org/)

### 社区

- [项目GitHub仓库](https://github.com/qilishidai/coc_robot)
- [Issues反馈](https://github.com/qilishidai/coc_robot/issues)
